$ServerName = Read-Host "Enter the server name"
$Credentials = Get-Credential

Connect-ExchangeServer -Server $ServerName -Credential $Credentials

$SaveLocation = Read-Host "Enter the save location for the report (e.g. C:\Reports)"

$Devices = Get-MobileDevice
$EnabledDevices = $Devices | Where-Object {$_.DeviceAccessState -eq 'Allowed'}
$Report = @()

foreach ($Device in $EnabledDevices) {
$Properties = @{
'User Principal Name' = $Device.UserDisplayName
'Device ID' = $Device.DeviceId
'Device Type' = $Device.DeviceType
'First Sync' = $Device.FirstSyncTime
}
$Report += New-Object -TypeName PSObject -Property $Properties
}

$Date = Get-Date -Format yyyyMMdd_HHmmss
$Report | Export-Csv -Path "$SaveLocation\ActiveSyncReport $Date.csv" -NoTypeInformation

Copy-Item "$SaveLocation\ActiveSyncReport $Date.csv" -Destination "\fileserver\cybersecurity\SAMA CSF Deliveries\20- BYOD\ActiveSyncReports"

Disconnect-ExchangeServer -Confirm:$false
